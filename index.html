<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CE - Command Executor (Full Version)</title>
  <style>
    body { margin: 0; background: #0a0a0a; color: white; font-family: sans-serif; display: flex; height: 100vh; }
    .sidebar { width: 40%; background: #111; padding: 10px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; }
    textarea { width: 100%; height: 28%; background: #222; color: #0f0; border: none; padding: 8px; font-family: monospace; font-size: 14px; resize: none; }
    iframe { width: 60%; height: 100%; border: none; background: white; }
    input { width: 100%; padding: 8px; background: #222; color: #0f0; border: none; font-family: monospace; margin-bottom: 5px; }
    button { padding: 10px; background: #00b300; border: none; color: white; cursor: pointer; }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>CE â€“ Command Executor (Full)</h2>

    <label>Project ID (auto loads):</label>
    <input id="projectId" placeholder="example: abc123" />

    <textarea id="html" placeholder="HTML here..."></textarea>
    <textarea id="css" placeholder="CSS here..."></textarea>
    <textarea id="js" placeholder="JavaScript here..."></textarea>

    <button id="run">Run</button>
    <button id="save">Save (Generate URL)</button>

    <p id="urlDisplay"></p>
  </div>

  <iframe id="preview"></iframe>

  <script>
    function runPreview() {
      const html = document.getElementById("html").value;
      const css = `<style>${document.getElementById("css").value}</style>`;
      const js = `<script>${document.getElementById("js").value}<\/script>`;
      const frame = document.getElementById("preview").contentWindow.document;
      frame.open();
      frame.write(html + css + js);
      frame.close();
    }

    document.getElementById("run").onclick = runPreview;

    function saveProject() {
      const id = Math.random().toString(36).slice(2, 10);
      const data = {
        html: document.getElementById("html").value,
        css: document.getElementById("css").value,
        js: document.getElementById("js").value
      };
      localStorage.setItem("CE_" + id, JSON.stringify(data));
      const url = window.location.origin + "?id=" + id;
      document.getElementById("urlDisplay").innerText = "Saved URL: " + url;
      window.history.replaceState(null, "", `?id=${id}`);
    }

    document.getElementById("save").onclick = saveProject;

    function loadProject(id) {
      const saved = localStorage.getItem("CE_" + id);
      if (!saved) return;
      const obj = JSON.parse(saved);
      document.getElementById("html").value = obj.html;
      document.getElementById("css").value = obj.css;
      document.getElementById("js").value = obj.js;
      runPreview();
    }

    const urlId = new URLSearchParams(window.location.search).get("id");
    if (urlId) {
      document.getElementById("projectId").value = urlId;
      loadProject(urlId);
    }
      // Commands button
    const commandsBtn = document.createElement('button');
    commandsBtn.textContent = "Convert to Commands";
    document.querySelector('.sidebar').insertBefore(commandsBtn, document.getElementById('run'));

    commandsBtn.onclick = () => {
      const code = `<html>` + document.getElementById('html').value + `</html>`+
                   `
<style>` + document.getElementById('css').value + `</style>`+
                   `
<script>` + document.getElementById('js').value + `</script>`;
      document.getElementById('html').value = code;
      document.getElementById('css').value = "";
      document.getElementById('js').value = "";
    };

    function parseCommands(code) {
      let html = code.match(/<html>([\s\S]*?)<\/html>/)?.[1] || "";
      let css = code.match(/<style>([\s\S]*?)<\/style>/)?.[1] || "";
      let js = code.match(/<script>([\s\S]*?)<\/script>/)?.[1] || "";

      html = html
        .replace(/click=\"(.*?)\"/g, 'onclick="$1"')
        .replace(/hover=\"(.*?)\"/g, 'onmouseover="$1"')
        .replace(/leave=\"(.*?)\"/g, 'onmouseout="$1"')
        .replace(/press=\"(.*?)\"/g, 'onmousedown="$1"')
        .replace(/release=\"(.*?)\"/g, 'onmouseup="$1"');

      return { html, css, js };
    }

    // Detect Commands mode
    const runButton = document.getElementById('run');
    runButton.onclick = () => {
      const text = document.getElementById('html').value;
      if (text.includes('<html>') && text.includes('<style>') && text.includes('<script>')) {
        const parsed = parseCommands(text);
        document.getElementById('html').value = parsed.html;
        document.getElementById('css').value = parsed.css;
        document.getElementById('js').value = parsed.js;
      }
      runPreview();
    };

  </script>
</body>
</html>
